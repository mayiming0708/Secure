<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>AdminLTE 2 | Dashboard</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.7 -->
		<link rel="stylesheet" href="/static/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
		<!-- Ionicons -->
		<link rel="stylesheet" href="/static/Ionicons/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="/static/css/AdminLTE.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="/static/css/_all-skins.css">
		<!-- Morris chart -->
		<!--<link rel="stylesheet" href="/static/css/morris.css">-->
		<link rel="stylesheet" href="/static/css/daterangepicker.css">
		<link rel="stylesheet" href="/static/iconfont/iconfon.css">
		<!-- bootstrap wysihtml5 - text editor -->
		<link rel="stylesheet" href="/static/css/bootstrap3-wysihtml5.min.css">
		<link rel="stylesheet" type="text/css" href="/static/css/dataTables.bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-table.css" />
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-select.min.css" />
		<!-- Google Font -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
		<link rel="stylesheet" type="text/css" href="/static/css/index.css" />

		<style>
			.sidebar .user-panel {
				display: none;
			}
			
			.sidebar .sidebar-form {
				display: none;
			}
			
			.sidebar-menu.tree li.header {
				display: none;
			}
			
			.temporary-task {
				margin-bottom: 20px;
				background: #fff;
				box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
				border-radius: 3px;
				height: 300px;
			}
			
			.temporary-task .title {
				line-height: 35px;
				padding: 0 10px;
				font-size: 20px;
				color: #444;
			}
			
			.pull-left.header .fa-inbox {
				color: lightseagreen;
			}
			
			.nav-tabs-custom {
				/*box-shadow: 0 0 2px rgba(0,0,0,0.3);*/
				border-radius: 10px;
			}
			
			#tempory-task .flow {
				margin-top: 18px;
				position: relative;
				display: inline-block;
				float: left;
			}
			
			#tempory-task .line {
				position: absolute;
				width: 2px;
				border-radius: 5px;
				height: 240px;
				background-color: lightblue;
				left: 78%;
			}
			
			#tempory-task .flow-img {
				display: inline-block;
				list-style-type: none;
				position: relative;
				z-index: 2;
			}
			
			#tempory-task .flow-img li {
				height: 78px;
			}
		</style>
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">

			<header class="main-header">
				<!-- Logo -->
				<a href="#" class="logo">
					<!-- mini logo for sidebar mini 50x50 pixels -->
					<span class="logo-mini"><b>WE</b>B</span>
					<!-- logo for regular state and mobile devices -->
					<span class="logo-lg"><b>WEB</b>SOCK</span>
				</a>
				<!-- Header Navbar: style can be found in header.less -->
				<nav class="navbar navbar-static-top">
					<!-- Sidebar toggle button-->
					<a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
						<span class="sr-only">Toggle navigation</span>
					</a>

					<div class="navbar-custom-menu">
						<ul class="nav navbar-nav">
							<!-- Messages: style can be found in dropdown.less-->
							<li class="dropdown messages-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-envelope-o"></i>
									<span class="label label-success"></span>
								</a>
						</li>
							<!-- Notifications: style can be found in dropdown.less -->
							<li class="dropdown notifications-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-bell-o"></i>
									<span class="label label-warning"></span>
								</a>
							</li>
							<!-- Tasks: style can be found in dropdown.less -->
							<li class="dropdown tasks-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-flag-o"></i>
									<span class="label label-danger"></span>
								</a>
							</li>
							<!-- User Account: style can be found in dropdown.less -->
							<li class="dropdown user user-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<img src="/static/image/user2-160x160.jpg" class="user-image" alt="User Image">
									<span class="hidden-xs">Alexander Pierce</span>
								</a>
								<ul class="dropdown-menu">
									<!-- User image -->
									<li class="user-header">
										<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">

									</li>
									<!-- Menu Body -->
									<li class="user-body">
										<div class="row">
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat"  id="changePassword">修改密码</a>
											</div>
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat"  id="changeEmail">修改邮箱</a>
											</div>
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat" id="signOut">登出</a>
											</div>
										</div>
										<!-- /.row -->
									</li>
									<!-- Menu Footer-->

								</ul>
							</li>
							<!-- Control Sidebar Toggle Button -->
							<li>
								<a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
							</li>
						</ul>
					</div>
				</nav>
			</header>
			<!-- Left side column. contains the logo and sidebar -->
			<aside class="main-sidebar">
				<!-- sidebar: style can be found in sidebar.less -->
				<section class="sidebar">
					<!-- Sidebar user panel -->
					<div class="user-panel">
						<div class="pull-left image">
							<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">
						</div>
						<div class="pull-left info">
							<p>Alexander Pierce</p>
							<a href="#"><i class="fa fa-circle text-success"></i> Online</a>
						</div>
					</div>
					<!-- search form -->
					<form action="#" method="get" class="sidebar-form">
						<div class="input-group">
							<input type="text" name="q" class="form-control" placeholder="Search...">
							<span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
						</div>
					</form>
					<!-- /.search form -->
					<!-- sidebar menu: : style can be found in sidebar.less -->
					<ul class="sidebar-menu" data-widget="tree">

						<li class="active">
							<a href="newIndex">
								<i class="fa fa-th"></i> <span>首页</span>
								<span class="pull-right-container">
					              <small class="label pull-right bg-green">new</small>
					            </span>
							</a>
						</li>
						<li>
							<a href="taskprogress">
								<i class="fa fa-calendar"></i> <span>任务视图</span>
								<span class="pull-right-container">

					            </span>
							</a>
						</li>
						<li>
							<a href="sitemonitor">
								<i class="fa fa-calendar"></i> <span>网站视图</span>
								<span class="pull-right-container">

					            </span>
							</a>
						</li>
					</ul>
				</section>
				<!-- /.sidebar -->
			</aside>

			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper site-check">
				<div class="row">
					<section class="col-lg-12 title" style="display: none;">
						下发任务
					</section>
				</div>
				<div class="row">
					<div class="col-lg-12 task-search">
						<div class="panel panel-default">
							<div class="panel-heading">
								<i class="iconfont icon-sousuo"></i>监测网站查询
							</div>
							<div class="panel-body">
								<div class="row">
									<div class="form-group col-sm-3 task-type-progress">
										<label for="site-name">网站名称<p class="prompt"></p></label>
										<input type="text" id="site-name">
									</div>
									<!--<div class="form-group col-sm-3 task-time">-->
										<!--<label for="name">任务下发时间:<p class="prompt"></p></label>-->
										<!--<input type="text" id="datepicker">-->
									<!--</div>-->
									<div class="form-group col-sm-3 pull-right text-right task-search-btn">
										<button type="button" id="resetBtn" class="btn btn-danger btnAll">重置</button>
										<button type="button" id="queryBtn" class="btn btn-warning btnAll">查询</button>
									</div>
								</div>
				
							</div>
						</div>
						<div class="row">
							<div class="col-lg-12">
								<div class="panel panel-default">
									<div class="panel-heading">
										<i class="iconfont icon-wangzhan"></i>网站列表
										<div class="pull-right">
											<button type="button" id="addBtn" class="btn btn-success btn-xs btnAll" style="display: none">新增下发任务</button>
										</div>
									</div>
									<div class="panel-body">
										 <!--<div id="toolbar" class="btn-group">
								            <button id="btn_add" type="button" class="btn btn-default">
								                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
								            </button>
								            <button id="btn_edit" type="button" class="btn btn-default">
								                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
								            </button>
								            <button id="btn_delete" type="button" class="btn btn-default">
								                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
								            </button>
								        </div>-->
										<table class="table table-bordered table-striped table-condensed" id="site-check-table">
							            </table>
									</div>
								</div>
							</div>
						</div>
					</div>
				
				</div>
			</div>
			<footer class="main-footer">
				<div class="pull-right hidden-xs">
					<b>Version</b> 2.4.0
				</div>
				<strong>©2019 All right reserved. 陇ICP备18001310号-2</strong>
			</footer>
		</div>
		<!--修改密码弹窗-->
		<div class="modal-change-password" id="modalChangePassword"></div>
		<!--修改邮箱弹窗-->
		<div class="modal-change-email" id="modalChangeEmail"></div>
		<!--修改密码弹窗背景-->
		<div class="progress-bg"></div>
		</div>
		<!-- ./wrapper -->

		<script src="/static/js/jquery.min.js"></script>
		<!-- jQuery UI 1.11.4 -->
		<script src="/static/js/jquery-ui.min.js"></script>
		<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
		<script>
			$.widget.bridge('uibutton', $.ui.button);
		</script>
		<!-- Bootstrap 3.3.7 -->
		<script src="/static/js/bootstrap.min.js"></script>
		<!-- daterangepicker -->
		<script src="/static/js/moment.min.js"></script>
		<script src="/static/js/daterangepicker.js"></script>
		<!-- datepicker -->
		<script src="/static/js/bootstrap-datepicker.min.js"></script>
		<!-- Bootstrap WYSIHTML5 -->
		<script src="/static/js/bootstrap3-wysihtml5.all.min.js"></script>
		<!-- Slimscroll -->
		<script src="/static/js/jquery.slimscroll.min.js"></script>
		<!-- FastClick -->
		<script src="/static/js/fastclick.js"></script>
		<!--表格插件-->
		<script src="/static/js/jquery.dataTables.min.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="/static/js/dataTables.bootstrap.min.css" type="text/javascript" charset="utf-8"></script>-->
		<!-- AdminLTE App -->
		<script src="/static/js/adminlte.min.js"></script>
		<script src="/static/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-table.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-table-zh-CN.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-select.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
            var userId=getCookie("userId");
			//网站监测table
			var tableSite = $("#site-check-table");
			$(function(){
                judgeCookie();
				siteCheck();
				//点击增加任务按钮 跳转到下发任务页面
				$("#addBtn").click(function(){
				    window.location.href='taskprogress';
				});
				//点击查询按钮
				$("#queryBtn").click(function(){
				    var url=$("#site-name").val();
                    siteCheck(url);
				});
				//点击重置按钮
				$("#resetBtn").click(function(){
                    $("#site-name").val('');
                    var url=$("#site-name").val();
                    siteCheck(url);
				})
			})
			//网站表初始化
			function siteCheck(url){
				tableSite.bootstrapTable('destroy');
				tableSite.bootstrapTable({
                    url: "/perform/webListPage",
                    method:"post",
                    dataType:"json",
                    // contentType: "application/x-www-form-urlencoded",
					//是否显示行间隔色
					// toolbar: '#toolbar', //工具按钮用哪个容器
					striped: true, //是否显示行间隔色
					cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
					pagination: true, //是否显示分页（*）
					sortable: false, //是否启用排序
					sortOrder: "asc", //排序方式
					//          queryParams: oTableInit.queryParams,//传递参数（*）
					sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
					pageNumber: 1, //初始化加载第一页，默认第一页
					pageSize: 10, //每页的记录行数（*）
					pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
					// search: true, //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
					// strictSearch: true,
					showColumns: true, //是否显示所有的列
					showRefresh: true, //是否显示刷新按钮
					minimumCountColumns: 2, //最少允许的列数
					clickToSelect: true, //是否启用点击选中行
					//          height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
					uniqueId: "ID", //每一行的唯一标识，一般为主键列
					// showToggle: true, //是否显示详细视图和列表视图的切换按钮
					// cardView: false, //是否显示详细视图
					detailView: false,
                    queryParams: function (params) {//自定义参数，这里的参数是传给后台的，我这是是分页用的
                       if(url==''){
                           return {//这里的params是table提供的
                               currentPage: params.offset/params.limit+1,
                               pageSize: params.limit,//找多少条
                               userId:userId,
                               // isPeriod:0
                           };
					   }else{
                           return {//这里的params是table提供的
                               currentPage: params.offset/params.limit+1,
                               pageSize: params.limit,//找多少条
                               userId:userId,
                               url:url
                           };
					   }

                    },
					//表头
						columns: [{
						title: '站点',
						field: 'url', //id
						//	    		checkbox: true, //checkbox
						align: 'center', //对其方式
						valign: 'middle' //对其方式
					}, {
						title: '暗链',
						field: 'blackLinks',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }

					}, {
						title: '关键词',
						field: 'keyword',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: 'SQL注入漏洞',
						field: 'sqlInjection',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: 'XSS跨站脚本漏洞',
						field: 'xss',
						align: 'center',
						valign: 'middle',
                            class:'W80',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: '应用漏洞',
						field: 'webvul',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: '信息泄露',
						field: 'infoLeak',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: 'CGI漏洞',
						field: 'cgi',
						align: 'center',
						valign: 'middle',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					}, {
						title: 'CSRF跨站请求伪造漏洞',
						field: 'csrf',
						align: 'center',
						valign: 'middle',
                            class:'W80',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            },

					}, {
						title: '表单破解漏洞',
						field: 'formCrack',
						align: 'center',
						valign: 'middle',
                            class:'W80',
                            formatter:function(value,row,index){
                                if(value==-1){
                                    return '--';
                                }else{
                                    return value;
                                }
                            }
					},{
			    		title:"操作",
			    		field:"Button",
			    		events:"operateEvents",
			    		formatter:"AddFunctionAlty",
			    		align: 'center',
						valign: 'middle',
			    	}],
					onLoadSuccess: function(res) { //可不写
						//加载成功时
						console.log(res);
					},
					onLoadError: function(statusCode) {
						return "加载失败了"
					},
					formatLoadingMessage: function() {
						//正在加载
						return "拼命加载中...";
					},
					formatNoMatches: function() {
						//没有匹配的结果
						return '无符合条件的记录';
					}
				})
			}
			
				//创建按钮并给按钮添加事件
		function AddFunctionAlty(value,row,index){
			return [
			'<button id="detailBtn" type="button" class="btn  btn-warning">查看详情</button>'
			];
		}
		window.operateEvents={
			"click #detailBtn":function(e,value,row,index){
				//跳转到网站漏洞详情页
                window.location.href = "sitedetail?url="+row.url;
			}
		}
		</script>
	</body>

</html>