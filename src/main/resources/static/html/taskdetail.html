<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>AdminLTE 2 | Dashboard</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.7 -->
		<link rel="stylesheet" href="/static/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
		<!-- Ionicons -->
		<link rel="stylesheet" href="/static/Ionicons/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="/static/css/AdminLTE.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="/static/css/_all-skins.css">
		<!-- Morris chart -->
		<!--<link rel="stylesheet" href="/static/css/morris.css">-->
		<link rel="stylesheet" href="/static/css/daterangepicker.css">
		<!-- bootstrap wysihtml5 - text editor -->
		<link rel="stylesheet" href="/static/css/bootstrap3-wysihtml5.min.css">
		<link rel="stylesheet" type="text/css" href="/static/css/dataTables.bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-table.css" />
		<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-select.min.css" />
		<!-- Google Font -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
		<link rel="stylesheet" type="text/css" href="/static/css/index.css" />

		<style>
			.sidebar .user-panel {
				display: none;
			}
			
			.sidebar .sidebar-form {
				display: none;
			}
			
			.sidebar-menu.tree li.header {
				display: none;
			}
			
			.temporary-task {
				margin-bottom: 20px;
				background: #fff;
				box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
				border-radius: 3px;
				height: 300px;
			}
			
			.temporary-task .title {
				line-height: 35px;
				padding: 0 10px;
				font-size: 20px;
				color: #444;
			}
			
			.pull-left.header .fa-inbox {
				color: lightseagreen;
			}
			
			.nav-tabs-custom {
				/*box-shadow: 0 0 2px rgba(0,0,0,0.3);*/
				border-radius: 10px;
			}
			
			#tempory-task .flow {
				margin-top: 18px;
				position: relative;
				display: inline-block;
				float: left;
			}
			
			#tempory-task .line {
				position: absolute;
				width: 2px;
				border-radius: 5px;
				height: 240px;
				background-color: lightblue;
				left: 78%;
			}
			
			#tempory-task .flow-img {
				display: inline-block;
				list-style-type: none;
				position: relative;
				z-index: 2;
			}
			
			#tempory-task .flow-img li {
				height: 78px;
			}
			@media screen and (max-width: 543px) {
				.task-detail-title{
					width: 100%;
					position: absolute;
				}
				.task-detail-title a{
					width: 100%;
					text-align: center;
				}
				.task-detail-title #btn-html2canvas{
					position: absolute;
					right: 0;
					height: 33px;
					line-height: 33px;
					border-radius: 5px;
				}
			}
		</style>
	</head>

	<body class="hold-transition skin-blue sidebar-mini" id="content">
		<div class="wrapper">

			<header class="main-header">
				<!-- Logo -->
				<a href="#" class="logo">
					<!-- mini logo for sidebar mini 50x50 pixels -->
					<span class="logo-mini"><b>WE</b>B</span>
					<!-- logo for regular state and mobile devices -->
					<span class="logo-lg"><b>WEB</b>SOCK</span>
				</a>
				<!-- Header Navbar: style can be found in header.less -->
				<nav class="navbar navbar-static-top">
					<!-- Sidebar toggle button-->
					<a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
						<span class="sr-only">Toggle navigation</span>
					</a>

					<div class="navbar-custom-menu">
						<ul class="nav navbar-nav">
							<!-- Messages: style can be found in dropdown.less-->
							<li class="dropdown messages-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-envelope-o"></i>
								</a>
						</li>
							<!-- Notifications: style can be found in dropdown.less -->
							<li class="dropdown notifications-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-bell-o"></i>
								</a>
						</li>
							<!-- Tasks: style can be found in dropdown.less -->
							<li class="dropdown tasks-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="fa fa-flag-o"></i>
								</a>
						</li>
							<!-- User Account: style can be found in dropdown.less -->
							<li class="dropdown user user-menu">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<img src="/static/image/user2-160x160.jpg" class="user-image" alt="User Image">
									<span class="hidden-xs">Alexander Pierce</span>
								</a>
								<ul class="dropdown-menu">
									<!-- User image -->
									<li class="user-header">
										<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">

									</li>
									<!-- Menu Body -->
									<li class="user-body">
										<div class="row">
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat" id="changePassword">修改密码</a>
											</div>
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat" id="changeEmail">修改邮箱</a>
											</div>
											<div class="col-xs-4 text-center">
												<a href="#" class="btn btn-default btn-flat" id="signOut">登出</a>
											</div>
										</div>
										<!-- /.row -->
									</li>
									<!-- Menu Footer-->

								</ul>

							</li>
							<!-- Control Sidebar Toggle Button -->
							<li>
								<a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
							</li>
						</ul>
					</div>
				</nav>
			</header>
			<!-- Left side column. contains the logo and sidebar -->
			<aside class="main-sidebar">
				<!-- sidebar: style can be found in sidebar.less -->
				<section class="sidebar">
					<!-- Sidebar user panel -->
					<div class="user-panel">
						<div class="pull-left image">
							<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">
						</div>
						<div class="pull-left info">
							<p>Alexander Pierce</p>
							<a href="#"><i class="fa fa-circle text-success"></i> Online</a>
						</div>
					</div>
					<!-- search form -->
					<form action="#" method="get" class="sidebar-form">
						<div class="input-group">
							<input type="text" name="q" class="form-control" placeholder="Search...">
							<span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
						</div>
					</form>
					<!-- /.search form -->
					<!-- sidebar menu: : style can be found in sidebar.less -->
					<ul class="sidebar-menu" data-widget="tree">

						<li class="active">
							<a href="newIndex">
								<i class="fa fa-th"></i> <span>首页</span>
								<span class="pull-right-container">
					              <small class="label pull-right bg-green">new</small>
					            </span>
							</a>
						</li>
						<li>
							<a href="taskprogress">
								<i class="fa fa-calendar"></i> <span>任务视图</span>
								<span class="pull-right-container">
					            </span>
							</a>
						</li>
						<li>
							<a href="sitemonitor">
								<i class="fa fa-calendar"></i> <span>网站视图</span>
								<span class="pull-right-container">
					            </span>
							</a>
						</li>
					</ul>
				</section>
				<!-- /.sidebar -->
			</aside>

			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper task">
			<div class="row">
					<section class="col-lg-12 connectedSortable">
						<div class="nav-tabs-custom task-detail">
							<ul class="nav nav-tabs pull-right">
								<!--<li class="pull-right"><button id="btn-html2canvas">导出为PDF</button></li>-->
								<li class="col-md-6 task-detail-title">
									<button id="btn-html2canvas">导出为PDF</button>
									<a href="#ablity" data-toggle="tab" class="active pull-right">任务检测详情列表</a>
								</li>
								<li class="pull-left header col-md-6"><i class="fa fa-inbox"></i><span></span></li>
							</ul>
							<div class="tab-content no-padding">
							<div class="tab-pane active" id="ablity">
									<div class="row">
										<div class="col-lg-12">
											<div class="panel panel-default">
												<div class="panel-heading">
													可用性检测列表
												</div>
												<div class="panel-body">
													<table class="table table-bordered table-striped table-condensed" id="task-abilty-table">

													</table>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-12">
											<div class="panel panel-default ablity-chart">
												<div class="panel-heading">
													安全事件检测列表
												</div>
												<div class="panel-body">
													<table class="table table-bordered table-striped table-condensed" id="task-safety-table">

													</table>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-lg-12">
											<div class="panel panel-default ablity-chart">
												<div class="panel-heading">
													漏洞检测列表
												</div>
												<div class="panel-body">
													<table class="table table-bordered table-striped table-condensed" id="task-leak-table">

													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</section>
				</div>
			</div>
			<!--修改密码弹窗-->
			<div class="modal-change-password" id="modalChangePassword"></div>
			<!--修改密码弹窗背景-->
			<div class="progress-bg"></div>
			<!--修改邮箱弹窗-->
			<div class="modal-change-email" id="modalChangeEmail"></div>
		</div>
		<!-- ./wrapper -->

		<script src="/static/js/jquery.min.js"></script>
		<!-- jQuery UI 1.11.4 -->
		<script src="/static/js/jquery-ui.min.js"></script>
		<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
		<script>
			$.widget.bridge('uibutton', $.ui.button);
		</script>
		<!-- Bootstrap 3.3.7 -->
		<script src="/static/js/bootstrap.min.js"></script>
		<!-- daterangepicker -->
		<script src="/static/js/moment.min.js"></script>
		<script src="/static/js/daterangepicker.js"></script>
		<!-- datepicker -->
		<script src="/static/js/bootstrap-datepicker.min.js"></script>
		<!-- Bootstrap WYSIHTML5 -->
		<script src="/static/js/bootstrap3-wysihtml5.all.min.js"></script>
		<!-- Slimscroll -->
		<script src="/static/js/jquery.slimscroll.min.js"></script>
		<!-- FastClick -->
		<script src="/static/js/fastclick.js"></script>
		<!--表格插件-->
		<script src="/static/js/jquery.dataTables.min.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="/static/js/dataTables.bootstrap.min.css" type="text/javascript" charset="utf-8"></script>-->
		<!-- AdminLTE App -->
		<script src="/static/js/adminlte.min.js"></script>
		<script src="/static/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-table.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-table-zh-CN.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/bootstrap-select.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/cut/html2canvas.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/cut/jspdf.debug.js" type="text/javascript" charset="utf-8"></script>
		<!--<script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>-->
		<script src="/static/js/cut/main.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			//获取此任务的详细信息 读取url后面传过来的id参数
            function GetQueryString(name)
            {
                var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);//search,查询？后面的参数，并匹配正则
                if(r!=null)return  unescape(r[2]); return null;
            }
            // var id=GetQueryString("id");
            // var taskId=getCookie(id);
            var taskId=GetQueryString("id");
            var isPeriod=GetQueryString("isPeriod");
			var userId=getCookie("userId");
            console.log(isPeriod);
			//概述table
			var tableSummary = $("#task-summary-table");
			var tableAbility= $("#task-abilty-table");
			var tableLeak=$("#task-leak-table");
            var tableSafe=$("#task-safety-table");
			$(function() {
                judgeCookie();
				//概述表
				tableInit();
				//可用性表
				abilityTable();
				//漏洞表格
				leakTable();

				tableSummary.bootstrapTable('hideLoading');
				//任务详情接口
                getTaskDetail();
                //任务名称填充
				$(".task-detail .nav .header span").html(taskId);


			})
			//获取该任务id的详细信息
			function getTaskDetail(){
                $.ajax({
                    type:"get",
                    url:"/service/resultEvents?virtualGroupId="+taskId,
                    xhrFields: {withCredentials: true},
                    dataType: "json",
                    async:true,
                    success:function(data){
                        console.log(data);
                        //从data中获取可用性 安全事件 漏洞的值
						 taskItemDetail(data);
                    }
                });
			}
			//概述表初始化
			function tableInit() {
				tableSummary.bootstrapTable('destroy');
				tableSummary.bootstrapTable({
					//gau请求地址,此处数据为本地加载
					url: "/static/json/tableSummary.json",
					//请求方式
					method: "GET",
					//table高度：如果没有设置，表格自动根据记录条数觉得表格高度
					//	    	height: '582',
					//是否显示行间隔色
					toolbar: '#toolbar', //工具按钮用哪个容器
					striped: true, //是否显示行间隔色
					cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
					pagination: true, //是否显示分页（*）
					sortable: false, //是否启用排序
					sortOrder: "asc", //排序方式
					//          queryParams: oTableInit.queryParams,//传递参数（*）
					sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
					pageNumber: 1, //初始化加载第一页，默认第一页
					pageSize: 10, //每页的记录行数（*）
					pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
					search: true, //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
					strictSearch: true,
					showColumns: true, //是否显示所有的列
					showRefresh: true, //是否显示刷新按钮
					minimumCountColumns: 2, //最少允许的列数
					clickToSelect: true, //是否启用点击选中行
					//          height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
					uniqueId: "ID", //每一行的唯一标识，一般为主键列
					showToggle: true, //是否显示详细视图和列表视图的切换按钮
					cardView: false, //是否显示详细视图
					detailView: false,
					//表头
					columns: [{
						title: '检测项',
						field: 'taskItem', //id
						//	    		checkbox: true, //checkbox
						align: 'center', //对其方式
						valign: 'middle' //对其方式
					}, {
						title: '开始检测时间',
						field: 'startTime',
						align: 'center',
						valign: 'middle',
					}, {
						title: '结束检测时间',
						field: 'endTime',
						align: 'center',
						valign: 'middle'
					}, {
						title: '检测状态',
						field: 'progress',
						align: 'center',
						valign: 'middle'
					}],
					onLoadSuccess: function(res) { //可不写
						//加载成功时
						console.log(res);
					},
					onLoadError: function(statusCode) {
						return "加载失败了"
					},
					formatLoadingMessage: function() {
						//正在加载
						return "拼命加载中...";
					},
					formatNoMatches: function() {
						//没有匹配的结果
						return '无符合条件的记录';
					}
				})
			}
			//可用性表初始化
			function abilityTable(abilityData){
				tableAbility.bootstrapTable('destroy');
				tableAbility.bootstrapTable({
					//gau请求地址,此处数据为本地加载
					url: "",
					//请求方式
                    method: 'get',
                    cache: false,
                    // height: 400,
                    striped: true,
                    pagination: true,
                    pageSize: 10,
                    pageNumber:1,
                    pageList: [10, 20, 50, 100, 200, 500],
					sidePagination:'client',
                    // search: true,
                    showColumns: true,
                    showRefresh: false,
                    showExport: false,
                    exportTypes: ['csv','txt','xml'],
                    // search: true,
                    clickToSelect: true,
                    columns:
                        [
                            {field:"site",title:"检测站点",align:"center",valign:"middle",sortable:"true"},
                            {field:"startAt",title:"开始测试时间",align:"center",valign:"middle",sortable:"true"},
                            {field:"endAt",title:"结束检测时间",align:"center",valign:"middle",sortable:"true"},
                            {
                                field:"value",
								title:"dns响应状态",
								align:"center",
								valign:"middle",
								sortable:"true",
								formatter:function(value,row,index){
                                    var value=JSON.parse(value);
									var dns=value[0].value['dns_hijack'].hijacked;
									if(dns==false){
										return "无DNS劫持";
									}else{
                                        return "DNS响应异常";
									}
								}
							},
                            {
                                field:"value",
								title:"HTTP响应状态",
								align:"center",
								valign:"middle",
								sortable:"true",
                                formatter:function(value,row,index){
                                    var value=JSON.parse(value);
                                    var http=value[0].value['http_get'];
                                    console.log(http);
                                    var status='';
                                    if(http==''||http==undefined||http==null){
                                        status='--';
									}else{
                                        status=http.status;
									}
									if(status=='--'){
									    return '--';
									}else if(status==200){
                                        return "正常";
									}else{
                                        return "异常";
									}
                                }
							},
                        ],
                    data:abilityData,
					onLoadSuccess: function(res) { //可不写
						//加载成功时
                        if(isPeriod==0){
                            console.log(isPeriod);
                            alert('临时');
                            // $('#tableOrderRealItems').bootstrapTable('showColumn', 'ShopName');
                            tableAbility.bootstrapTable('hideColumn', 'testTime')
                        }
						console.log(res);
					},
					onLoadError: function(statusCode) {
						return "加载失败了"
					},
					formatLoadingMessage: function() {
						//正在加载
						return "拼命加载中...";
					},
					formatNoMatches: function() {
						//没有匹配的结果
						return '无符合条件的记录';
					}
				})
			}
			//漏洞表初始化
			function leakTable(weaknessData){
				tableLeak.bootstrapTable('destroy');
				tableLeak.bootstrapTable({
					//gau请求地址,此处数据为本地加载
                    url: "",
                    //请求方式
                    method: 'get',
                    cache: false,
                    // height: 400,
                    striped: true,
                    pagination: true,
                    pageSize: 10,
                    pageNumber:1,
                    pageList: [10, 20, 50, 100, 200, 500],
                    sidePagination:'client',
                    // search: true,
                    showColumns: true,
                    showRefresh: false,
                    showExport: false,
                    exportTypes: ['csv','txt','xml'],
                    // search: true,
                    // clickToSelect: true,
                    columns:
                        [
                            {field:"site",title:"检测站点",align:"center",valign:"middle",sortable:"true"},

                            {
                                field:"value",
                                title:"CGI",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var cgi=0;
                                    var value=JSON.parse(value);
                                  for(var i=0;i<value.length;i++){
										if(value[i].type=="cgi"){
                                            cgi=cgi+1;
										}
								  }
								  return cgi;
                                },
                            },
                            {
                                field:"value",
                                title:"应用漏洞",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var webvul=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="webvul"){
                                            webvul=webvul+1;
                                        }
                                    }
                                    return webvul;
                                }
                            },
                            {
                                field:"value",
                                title:"CSRF",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var csrf=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="csrf"){
                                            csrf=csrf+1;
                                        }
                                    }
                                    return csrf;
                                }
                            },
                            {
                                field:"value",
                                title:"SQL注入",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var sql=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="sql"){
                                            sql=sql+1;
                                        }
                                    }
                                    return sql;
                                }
                            },
                            {
                                field:"value",
                                title:"XSS",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var xss=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="xss"){
                                            xss=xss+1;
                                        }
                                    }
                                    return xss;
                                }
                            },
                            {
                                field:"value",
                                title:"表单破解",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var formCrack=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="formCrack"){
                                            formCrack=formCrack+1;
                                        }
                                    }
                                    return formCrack;
                                }
                            },
                            {field:"endAt",title:"结束检测时间",align:"center",valign:"middle",sortable:"true"},
                            {
                            title:"操作",
                            field:"Button",
                            events:"operateEvents",
                            formatter:"AddFunctionAlty"
                        }
                        ],
                    data:weaknessData,
					onLoadSuccess: function(res) { //可不写
						//加载成功时
						console.log(res);
					},
					onLoadError: function(statusCode) {
						return "加载失败了"
					},
					formatLoadingMessage: function() {
						//正在加载
						return "拼命加载中...";
					},
					formatNoMatches: function() {
						//没有匹配的结果
						return '无符合条件的记录';
					}
				})
			}
			//安全事件表初始化
			function safetyTable(contentData){
			    console.log(contentData);
                tableSafe.bootstrapTable('destroy');
                tableSafe.bootstrapTable({
                    //gau请求地址,此处数据为本地加载
                    url: "",
                    //请求方式
                    method: 'get',
                    cache: false,
                    // height: 400,
                    striped: true,
                    pagination: true,
                    pageSize: 10,
                    pageNumber:1,
                    pageList: [10, 20, 50, 100, 200, 500],
                    sidePagination:'client',
                    // search: true,
                    showColumns: true,
                    showRefresh: false,
                    showExport: false,
                    exportTypes: ['csv','txt','xml'],
                    // search: true,
                    clickToSelect: true,
                    columns:
                        [
                            {field:"site",title:"检测站点",align:"center",valign:"middle",sortable:"true"},

                            {
                                field:"value",
                                title:"关键词",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var keyword=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="keyword"){
                                            keyword=keyword+1;
                                        }
                                    }
                                    return keyword;
                                }
                            },
                            {
                                field:"value",
                                title:"挂马",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var malscan=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="malscan"){
                                            malscan=malscan+1;
                                        }
                                    }
                                    return malscan;
                                }
                            },
                            {
                                field:"value",
                                title:"信息泄露",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var infoLeak=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="info_leak"){
                                            infoLeak=infoLeak+1;
                                        }
                                    }
                                    return infoLeak;
                                }
                            },
                            {
                                field:"value",
                                title:"暗链",
                                align:"center",
                                valign:"middle",
                                sortable:"true",
                                formatter:function(value,row,index){
                                    var black_links	=0;
                                    var value=JSON.parse(value);
                                    for(var i=0;i<value.length;i++){
                                        if(value[i].type=="black_links"){
                                            black_links=black_links+1;
                                        }
                                    }
                                    return black_links;
                                }
                            },
                            {field:"endAt",title:"结束检测时间",align:"center",valign:"middle",sortable:"true"},
                            {
                                title:"操作",
                                field:"Button",
                                events:"operateEvents",
                                formatter:"AddFunctionAlty"
                            }
                        ],
                    data:contentData,
                    onLoadSuccess: function(res) { //可不写
                        //加载成功时
                        console.log(res);
                    },
                    onLoadError: function(statusCode) {
                        return "加载失败了"
                    },
                    formatLoadingMessage: function() {
                        //正在加载
                        return "拼命加载中...";
                    },
                    formatNoMatches: function() {
                        //没有匹配的结果
                        return '无符合条件的记录';
                    }
                })
			}
		//创建按钮并给按钮添加事件
		function AddFunctionAlty(value,row,index){
			return [
			'<button id="detailBtn" type="button" class="btn  btn-warning">查看详情</button>'
			];
		}
		window.operateEvents={
			"click #detailBtn":function(e,value,row,index){
			    var site=row.site;
                window.location.href = "sitedetail?url="+site;
			}
		}
         function taskItemDetail(data){
			    var abilityCount=0;
			    var weaklessCount=0;
			    var abilityData=[];
			    var weaknessData=[];
			    var siteinfoData=[];
			    for(var i=0;i<data.length;i++){
			        if(data[i].moduleType=="availability"){
                        abilityData.push(data[i]);
                        console.log(data[i]);
					}
					if(data[i].moduleType=="weakness"){
                        weaknessData.push(data[i]);
					}
                    if(data[i].moduleType=="siteinfo"){
                        siteinfoData.push(data[i]);
                    }
				}
             abilityTable(abilityData);
             leakTable(weaknessData);
			 safetyTable(weaknessData);
			 //概述table的描述

			 var dataTotal=[abilityData,weaknessData];
             tableInit(dataTotal);
			 for(var i=0;i<weaknessData.length;i++){
                 var vul=JSON.parse(weaknessData[0].value);
                 console.log(vul);
			 }


			 //概述表传入的data
			 // var summaryData=[{"checkItem":"可用性","startAt":"2018-10-6","startEnd":"2018-10-9"},{"checkItem":"安全事件"},{"checkItem":"漏洞"}]

		 }




        </script>
	</body>

</html>