<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>AdminLTE 2 | Dashboard</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/static/font-awesome/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="/static/Ionicons/css/ionicons.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="/static/css/AdminLTE.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
   folder instead of downloading all of them to reduce the load. -->
	<link rel="stylesheet" href="/static/css/_all-skins.css">
	<!-- Morris chart -->
	<link rel="stylesheet" href="/static/iconfont/iconfon.css">
	<!--<link rel="stylesheet" href="/static/css/morris.css">-->
	<link rel="stylesheet" href="/static/css/daterangepicker.css">
	<!-- bootstrap wysihtml5 - text editor -->
	<link rel="stylesheet" href="/static/css/bootstrap3-wysihtml5.min.css">
	<link rel="stylesheet" type="text/css" href="/static/css/dataTables.bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-table.css"/>
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap-select.min.css"/>
	<!-- Google Font -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
	<link rel="stylesheet" type="text/css" href="/static/css/index.css" />

	<style>
		.sidebar .user-panel {
			display: none;
		}

		.sidebar .sidebar-form {
			display: none;
		}

		.sidebar-menu.tree li.header {
			display: none;
		}

		.temporary-task {
			margin-bottom: 20px;
			background: #fff;
			box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
			border-radius: 3px;
			height: 300px;
		}

		.temporary-task .title {
			line-height: 35px;
			padding: 0 10px;
			font-size: 20px;
			color: #444;
		}

		.pull-left.header .fa-inbox {
			color: lightseagreen;
		}

		.nav-tabs-custom {
			/*box-shadow: 0 0 2px rgba(0,0,0,0.3);*/
			border-radius: 10px;
		}

		#tempory-task .flow {
			margin-top: 18px;
			position: relative;
			display: inline-block;
			float: left;
		}

		#tempory-task .line {
			position: absolute;
			width: 2px;
			border-radius: 5px;
			height: 240px;
			background-color: lightblue;
			left: 78%;
		}

		#tempory-task .flow-img {
			display: inline-block;
			list-style-type: none;
			position: relative;
			z-index: 2;
		}

		#tempory-task .flow-img li {
			height: 78px;
		}
		.icon-youxiang{
			font-size: 20px;
		}
	</style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<header class="main-header">
		<!-- Logo -->
		<a href="#" class="logo">
			<!-- mini logo for sidebar mini 50x50 pixels -->
			<span class="logo-mini"><b>WE</b>B</span>
			<!-- logo for regular state and mobile devices -->
			<span class="logo-lg"><b>WEB</b>SOCK</span>
		</a>
		<!-- Header Navbar: style can be found in header.less -->
		<nav class="navbar navbar-static-top">
			<!-- Sidebar toggle button-->
			<a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
				<span class="sr-only">Toggle navigation</span>
			</a>

			<div class="navbar-custom-menu">
				<ul class="nav navbar-nav">
					<!-- Messages: style can be found in dropdown.less-->
					<li class="dropdown messages-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<i class="fa fa-envelope-o"></i>
							<span class="label label-success"></span>
						</a>
					</li>
					<!-- Notifications: style can be found in dropdown.less -->
					<li class="dropdown notifications-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<i class="fa fa-bell-o"></i>
							<span class="label label-warning"></span>
						</a>
					</li>
					<!-- Tasks: style can be found in dropdown.less -->
					<li class="dropdown tasks-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<i class="fa fa-flag-o"></i>
							<span class="label label-danger"></span>
						</a>
					</li>
					<!-- User Account: style can be found in dropdown.less -->
					<li class="dropdown user user-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img src="/static/image/user2-160x160.jpg" class="user-image" alt="User Image">
							<span class="hidden-xs">Alexander Pierce</span>
						</a>
						<ul class="dropdown-menu">
							<!-- User image -->
							<li class="user-header">
								<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">

							</li>
							<!-- Menu Body -->
							<li class="user-body">
								<div class="row">
									<div class="col-xs-4 text-center">
										<a href="#" class="btn btn-default btn-flat" id="changePassword">修改密码</a>
									</div>
									<div class="col-xs-4 text-center">
										<a href="#" class="btn btn-default btn-flat" id="changeEmail">修改邮箱</a>
									</div>
									<div class="col-xs-4 text-center">
										<a href="#" class="btn btn-default btn-flat" id="signOut">登出</a>
									</div>
								</div>
								<!-- /.row -->
							</li>
							<!-- Menu Footer-->

						</ul>
					</li>
					<!-- Control Sidebar Toggle Button -->
					<li>
						<a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
					</li>
				</ul>
			</div>
		</nav>
	</header>
	<!-- Left side column. contains the logo and sidebar -->
	<aside class="main-sidebar">
		<!-- sidebar: style can be found in sidebar.less -->
		<section class="sidebar">
			<!-- Sidebar user panel -->
			<div class="user-panel">
				<div class="pull-left image">
					<img src="/static/image/user2-160x160.jpg" class="img-circle" alt="User Image">
				</div>
				<div class="pull-left info">
					<p>Alexander Pierce</p>
					<a href="#"><i class="fa fa-circle text-success"></i> Online</a>
				</div>
			</div>
			<!-- search form -->
			<form action="#" method="get" class="sidebar-form">
				<div class="input-group">
					<input type="text" name="q" class="form-control" placeholder="Search...">
					<span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
				</div>
			</form>
			<!-- /.search form -->
			<!-- sidebar menu: : style can be found in sidebar.less -->
			<ul class="sidebar-menu" data-widget="tree">

				<li class="active">
					<a href="newIndex">
						<i class="fa fa-th"></i> <span>首页</span>
						<span class="pull-right-container">
					              <small class="label pull-right bg-green">new</small>
					            </span>
					</a>
				</li>
				<li>
					<a href="taskprogress">
						<i class="fa fa-calendar"></i> <span>任务视图</span>
						<span class="pull-right-container">
					            </span>
					</a>
				</li>
				<li>
					<a href="sitemonitor">
						<i class="fa fa-calendar"></i> <span>网站视图</span>
						<span class="pull-right-container">

						</span>
					</a>
				</li>
			</ul>
		</section>
		<!-- /.sidebar -->
	</aside>

	<!-- Content Wrapper. Contains page content -->
	<div class="content-wrapper task">
		<div class="row">
			<section class="col-lg-12 title" style="display: none;">
				下发任务
			</section>
		</div>
		<div class="row">
			<div class="col-lg-12 task-search">
				<div class="panel panel-default task-search-top">
					<div class="panel-heading">
						<i class="iconfont icon-sousuo"></i>下发任务查询
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="form-group col-sm-3 task-type-progress">
								<label for="name">任务类型:<p class="prompt"></p></label>
								<select name="task-type-choose">
									<option value="2">--请选择--</option>
									<option value="0">临时任务</option>
									<option value="1">周期任务</option>
								</select>
							</div>
							<div class="form-group col-sm-3 task-time">
								<label for="name">任务下发时间:<p class="prompt"></p></label>
								<input type="text" id="datepicker">
							</div>
							<div class="form-group col-sm-3 pull-right text-right task-search-btn">
								<button type="button" id="resetBtn" class="btn btn-danger btnAll">重置</button>
								<button type="button" id="queryBtn" class="btn btn-warning btnAll">查询</button>
							</div>
						</div>

					</div>
				</div>
				<div class="row">
					<div class="col-lg-12">
						<div class="panel panel-default task-search-bottom">
							<div class="panel-heading">
								<i class="iconfont icon-renwu"></i>任务列表
								<div class="pull-right">
									<button type="button" id="addBtn" class="btn btn-success btn-xs btnAll">新 增任务</button>
								</div>
							</div>
							<div class="panel-body">
								<!--<div id="toolbar" class="btn-group">
                                   <button id="btn_add" type="button" class="btn btn-default">
                                       <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                                   </button>
                                   <button id="btn_edit" type="button" class="btn btn-default">
                                       <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
                                   </button>
                                   <button id="btn_delete" type="button" class="btn btn-default">
                                       <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                                   </button>
                               </div>-->
								<table class="table table-bordered table-striped table-condensed" id="dtTable">
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="modal fade in" id="taskAddModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: none;">
			<div class="modal-dialog" role="document">
				<div class="modal-content" style="margin-top: 170px;">
					<div class="modal-body" style="overflow: hidden ;">
						<button type="button" class="close" aria-label="Close"><span aria-hidden="true">×</span></button>
						<div class="form-group task-type-progress">
							<label for="name">任务类型:<p class="prompt"></p></label>
							<select name="task-type-choose"  id="modal-task-type">
								<option value="0">临时任务</option>
								<option value="1">周期任务</option>
							</select>
						</div>
						<div class="form-group task-site">
							<label for="name">检测站点<p class="prompt">（*站点名为必填项，多个站点请以逗号分隔）</p></label>
							<input type="text" class="form-control" id="name" placeholder="请输入站点名称">
						</div>
						<div class="form-group task-check">
							<label for="name">检测项选择:<p class="prompt"></p></label>
							<ul class="checkbox clearfix">
								<li>
									<label>
										<input type="checkbox" id="all" value="0"> 全部
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="blank_link" value="0"> 暗链
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="malscan" value="0"> 挂马
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="keyword" value="0"> 关键词
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="sql" value="0"> SQL注入漏洞
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="xss" value="0"> XSS跨站脚本漏洞
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="webvul" value="0"> 应用漏洞
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="info_leak" value="0"> 信息泄露
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="cgi" value="0"> CGI漏洞
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="csrf" value="0"> CSRF跨站请求伪造漏洞
									</label>
								</li>
								<li>
									<label>
										<input type="checkbox" id="form_crack" value="0"> 表单破解漏洞
									</label>
								</li>
							</ul>
						</div>
						<div class="commit-btn" id="addTask">
							提交任务
						</div>
						<div class="cover">

						</div>
						<div class="pop-alert">
							<div class="title"><i class="fa fa-warning"></i><span></span></div>
							<div class="pop-alert-content">

							</div>
							<button type="button" class="btn btn-block btn-primary btn-flat">确定</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade in" id="emailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: none;">
			<div class="modal-dialog" role="document">
				<div class="modal-content" style="margin-top: 170px;">
					<div class="modal-body" style="overflow: hidden ;">
						<button type="button" class="close" aria-label="Close"><span aria-hidden="true">×</span></button>



						<div class="cover">

						</div>
						<div class="pop-alert">
							<div class="title"><i class="fa fa-warning"></i><span></span></div>
							<div class="pop-alert-content">

							</div>
							<button type="button" class="btn btn-block btn-primary btn-flat">确定</button>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<div class="deletecover"></div>
	<div class="delete-alert">
		<div class="title"><i class="fa fa-warning"></i>确定删除此任务?</div>
		<div class="cancel-delete">取消</div>
		<div class="deleteTask">确定</div>
	</div>
	<footer class="main-footer">
		<div class="pull-right hidden-xs">
			<b>Version</b> 2.4.0
		</div>
		<strong>©2019 All right reserved. 陇ICP备18001310号-2</strong>
	</footer>
	<!--修改密码弹窗-->
	<div class="modal-change-password" id="modalChangePassword"></div>
	<!--修改邮箱弹窗-->
	<div class="modal-change-email" id="modalChangeEmail"></div>
	<!--发送邮件弹窗-->
	<div class="modal-send-email" id="modalSendEmail">
		<div class="box box-info">
			<div class="box-header ui-sortable-handle" style="cursor: move;">
				<i class="fa fa-envelope"></i>

				<h3 class="box-title">发送邮件</h3>
				<!-- tools box -->
				<div class="pull-right box-tools">
					<button type="button" class="btn btn-info btn-sm" data-toggle="tooltip" title="">
						<i class="fa fa-times"></i></button>
				</div>
				<!-- /. tools -->
			</div>
			<div class="box-body">
				<form action="#" method="post">
					<div class="form-group">
						<input type="email" id="emitEmail" class="form-control" name="emailto" placeholder="收件人:">
					</div>
				</form>
				</form>
			</div>
			<div class="box-footer clearfix">
				<button type="button" class="pull-right btn btn-default" id="sendEmail">发送
					<i class="fa fa-arrow-circle-right"></i></button>
			</div>
		</div>
	</div>
	<!--修改密码弹窗背景-->
	<div class="progress-bg"></div>
</div>
<!-- ./wrapper -->

<script src="/static/js/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="/static/js/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script src="/static/js/bootstrap.min.js"></script>
<!-- daterangepicker -->
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/daterangepicker.js"></script>
<!-- datepicker -->
<script src="/static/js/bootstrap-datepicker.min.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="/static/js/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="/static/js/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="/static/js/fastclick.js"></script>
<!--表格插件-->
<script src="/static/js/jquery.dataTables.min.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="/static/js/dataTables.bootstrap.min.css" type="text/javascript" charset="utf-8"></script>-->
<!-- AdminLTE App -->
<script src="/static/js/adminlte.min.js"></script>
<script src="/static/js/echarts.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/bootstrap-table.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/bootstrap-table-zh-CN.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/bootstrap-select.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/common.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    var table = $("#dtTable");
    //获取到cookie值
    var userId=getCookie("userId");
    var temAlert = $("#taskAddModal .pop-alert-content");
    var temCover = $("#taskAddModal .cover");
    var temPop = $("#taskAddModal .pop-alert");
    var temBtn = $("#taskAddModal .pop-alert button");
    var temTitle = $("#taskAddModal  .pop-alert .title");
    var checkItem=$(".checkbox li input");
    var checkbox=$("#taskAddModal .checkbox");
    $(function(){
        judgeCookie();
        // urlList();
        // taskList();
        result();
        //时间选择器
        $("#datepicker").datepicker({
            language: "zh-CN",
            autoclose: true,
            dropupAuto: false,
            height:'400px'
        });

        //取消发送邮箱
		$("#modalSendEmail .btn-sm").click(function(){
			$("#modalSendEmail").hide();
			$(".progress-bg").hide();
		})
		//点击发送邮件 发送按钮
		$("#sendEmail").click(function(){
			var email=$("#emitEmail").val();
			$.ajax({
				type:"post",
				url:"/perform/sendMail",
				xhrFields: {withCredentials: true},
				data:{"address":email,content:''},
				dataType: "json",
				async:true,
				success:function(data){
					var type=$(".task-type-progress select").val();
					var time=$("#datepicker").val();
					// table.bootstrapTable('destroy');
					tableInit(type,time);
				}
			});
			alert('发送邮件成功');
			$("#modalSendEmail").hide();
			$(".progress-bg").hide();
		})
        //table表格初始化
        tableInit(2,'');
        table.bootstrapTable('hideLoading');

        $("#all").click(function(){
            var checkbox=$(this).parent().parent().parent().parent();
            if($(this).prop('checked')){
                checkbox.find('input').prop('checked','checked');
            }else{
                checkbox.find('input').prop('checked',false);
			}
        });
        checkbox.find('input:not("#all")').click(function(){
            if($(this).prop('checked')){

            }else{
                $("#all").prop('checked',false);
            }
        })

        //新增任务
        $("#addBtn").click(function() {
            //每次点击时重置弹窗
            $(".task-site input").val("");
            $(".checkbox li input").prop("checked",false);
            $("#taskAddModal").show();
            //点击全选时 所有复选框都选中

        });

		//新增弹框点击提交任务按钮
        $("#addTask").click(function() {
            var choose = 0;
            var item=[];
            //判断是否是周期任务
            var taskType = $('#modal-task-type option:selected').attr('value');
            //校验站点名
            var reg = '(https?|ftp|file)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]';
            var site = $("#taskAddModal #name");
            var siteVal = site.val();
            var siteArr = siteVal.split(',');

            //检验选择项
            checkItem.each(function() {
                var checkItemVal = $(this).prop('checked');
                if(checkItemVal == true) {
                    $(this).attr('value','1');
                    choose = choose + 1;
                }
                item.push($(this).attr('value'));
            });
            if(siteVal == '' || siteVal == null || siteVal == undefined) {
                temTitle.find('.fa').removeClass('fa-chevron-circle-down');
                temTitle.find('.fa').addClass('fa-warning');
                temTitle.find('span').html('下发任务失败');
                temAlert.html('请填写站点名');
                temCover.show();
                temPop.show();
                return false;
            } else {
                for(var i = 0; i < siteArr.length; i++) {
                    if(!siteArr[i].match(reg)) {
                        temTitle.find('.fa').removeClass('fa-chevron-circle-down');
                        temTitle.find('.fa').addClass('fa-warning');
                        temTitle.find('span').html('下发任务失败');
                        temAlert.html('填写的网站有误');
                        temCover.show();
                        temPop.show();
                        return false;
                    }
                }
            }
            if(choose == 0) {
                temTitle.find('.fa').removeClass('fa-chevron-circle-down');
                temTitle.find('.fa').addClass('fa-warning');
                temTitle.find('span').html('下发任务失败');
                temAlert.html('请选择检测项');
                temCover.show();
                temPop.show();
                return false;
            }else{
                addTaskItem(taskType,siteVal,item);
			}
        });
        //点击确定按钮 弹窗消失
        temBtn.click(function() {
            temCover.hide();
            temPop.hide();
            var type=$(".task-type-progress select").val();
            var time=$("#datepicker").val();
            // table.bootstrapTable('destroy');
            tableInit(type,time);
        });
        $("#taskAddModal .close").click(function(){
            $("#taskAddModal").hide();
        });

        $(window).resize(function() {
            //防止表头与表格不对齐
            table.bootstrapTable('resetView');
        });
		//列表查询 获取到需要查询的参数
		$("#queryBtn").click(function(){
            var type=$(".task-type-progress select").val();
			var time=$("#datepicker").val();
            tableInit(type,time);
		})
		//点重置按钮 重置条件
		$("#resetBtn").click(function(){
            $(".task-type-progress select").val(2);
           $("#datepicker").val('');

            tableInit(2,'');
		})


    })

    function tableInit(type,time) {

        table.bootstrapTable('destroy');
        table.bootstrapTable({
            url: "/perform/taskListPage",
			method:"post",
			dataType:"json",
            // contentType: "application/x-www-form-urlencoded",
            //table高度：如果没有设置，表格自动根据记录条数觉得表格高度
            //	    	height: '582',
            //是否显示行间隔色
            // toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: false,                     //是否启用排序
            sortOrder: "asc",                   //排序方式
            //          queryParams: oTableInit.queryParams,//传递参数（*）
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 10,                       //每页的记录行数（*）
            pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
            // search: true,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            // strictSearch: true,
            showColumns: true,                  //是否显示所有的列
			showRefresh: true,                  //是否显示刷新按钮
            minimumCountColumns: 2,             //最少允许的列数
            clickToSelect: true,                //是否启用点击选中行
            //          height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "ID",                     //每一行的唯一标识，一般为主键列
            // showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
            // cardView: false,                    //是否显示详细视图
            detailView: false,
            queryParams: function (params) {//自定义参数，这里的参数是传给后台的，我这是是分页用的
               if(type!=2&&time!=''){
                   return {//这里的params是table提供的
                       currentPage: params.offset/params.limit+1,
                       pageSize: params.limit,//找多少条
                       userId:userId,
						isPeriod:type,
					   createTime:time
                   };
			   }
			   if(type!=2&&(time=='')){
                   return {//这里的params是table提供的
                       currentPage: params.offset/params.limit+1,
                       pageSize: params.limit,//找多少条
                       userId:userId,
                       isPeriod:type,
                   };
			   }
			   if(type==2&&(time=='')){

                   return {
                       currentPage: params.offset/params.limit+1,
                       pageSize: params.limit,//找多少条
                       userId:userId,
                   };
			   }
			   if(type==2&&(time!='')){
                   return {//这里的params是table提供的
                       currentPage: params.offset/params.limit+1,
                       pageSize: params.limit,//找多少条
                       userId:userId,
                       createTime:time,
                   };
			   }

            },
            //表头
            columns: [{
                title: '任务ID',
                field: 'virtualGroupId', //id
                //	    		checkbox: true, //checkbox
                align: 'center', //对其方式
                valign: 'middle' //对其方式
            }
                , {
                    title: '任务类型',
                    field: 'isPeriod',
                    align: 'center',
                    valign: 'middle',
                    formatter:function(value,row,index){
                        if(value==0){
                            return "临时任务"
                        }else{
                            return "周期任务"
                        }
                    }
                }, {
                    title: '下发时间',
                    field: 'createTime',
                    align: 'center',
                    valign: 'middle'
                }, {
                    title: '检测进度',
                    field: 'finishRate',
                    align: 'center',
                    valign: 'middle',
                    formatter:function(value,row,index){
                        var percent=value*100+'%';
                        console.log(percent);
                        if(row.isPeriod==0){
                            return '<div class="total" style="position:relative">\n' +
                                '\t<div class="value" style="color:#000;">'+percent+'</div>\n' +
                                '\t<div class="progress" style="height:8px;border-radius: 5px;background-color: #ddd">\n' +
                                '\t<div class="progress-bar progress-bar-success" role="progressbar"\n' +
                                '\t\t aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"\n' +
                                '\t\t style="width:'+percent+';">\n' +
                                '\t\t<span class="sr-only">90% 完成（成功）</span>\n' +
                                '\t</div>\n' +
                                '\t\n' +
                                '</div>\n' +
                                '\t\n' +
                                '</div>';
                        }
                        else{
                            return "--";
                        }

                    }
                }
                , {
                    title: '检测网站',
                    field: 'urls',
                    align: 'center',
                    valign: 'middle',
					// class:'W160',
					formatter:function(value,row,index){
                        var urlArr=value.split(',');
                        var res=urlArr[0];
                       for(var i=1;i<urlArr.length;i++){
                           res=urlArr[0]+'<br>'+urlArr[i];
					   }
					   return '<div>'+res+'</div>';
					}
                },{
                    title:"操作",
                    field:"Button",
                    events:"operateEvents",
                    formatter:"AddFunctionAlty"
                }
            ],
            onLoadSuccess: function(res) { //可不写
                //加载成功时
                //  console.log(res);
            },
            onLoadError: function(statusCode) {
                return "加载失败了"
            },
            formatLoadingMessage: function() {
                //正在加载
                return "拼命加载中...";
            },
            formatNoMatches: function() {
                //没有匹配的结果
                return '无符合条件的记录';
            }
        })
    }
    //点击提交任务调用下发任务接口
    function addTaskItem(taskType,siteVal,item){
        //临时任务调取接口
        if(taskType==0){
            $.ajax({
                type:"post",
                url:"http://localhost/issue/temp",
                xhrFields: {withCredentials: true},
                data:JSON.stringify(
                    {"urls":siteVal,
                        "blackLinks":item[1],
                        "malscan":item[2],
                        "keyword":item[3],
                        "sqlInjection":item[4],
                        "xss":item[5],
                        "webvul":item[6],
                        "infoLeak":item[7],
                        "cgi":item[8],
                        "csrf":item[9],
                        "formCrack":item[10]
                    }),
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                async:true,
                success:function(data){
                    if(data.code==0){
                        temTitle.find('.fa').removeClass('fa-warning');
                        temTitle.find('.fa').addClass('fa-chevron-circle-down');
                        temTitle.find('span').html('下发任务成功');
                        temAlert.html('下发临时任务成功');
                        temCover.show();
                        temPop.show();
					}else{
                        temTitle.find('.fa').removeClass('fa-chevron-circle-down');
                        temTitle.find('.fa').addClass('fa-warning');
                        temTitle.find('span').html('下发任务失败');
                        temAlert.html(data.message);
                        temCover.show();
                        temPop.show();
					}

                }
            });
		}else{
            //周期任务调取接口
            $.ajax({
                type:"post",
                url:"http://localhost/issue/period",
                xhrFields: {withCredentials: true},
                data:JSON.stringify(
                    {"urls":siteVal,
                        "blackLinks":item[1],
                        "malscan":item[2],
                        "keyword":item[3],
                        "sqlInjection":item[4],
                        "xss":item[5],
                        "webvul":item[6],
                        "infoLeak":item[7],
                        "cgi":item[8],
                        "csrf":item[9],
                        "formCrack":item[10]
                    }),
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                async:true,
                success:function(data){
                    console.log(data);
                    if(data.code==0){
                        temTitle.find('.fa').removeClass('fa-warning');
                        temTitle.find('.fa').addClass('fa-chevron-circle-down');
                        temTitle.find('span').html('下发任务成功');
                        temAlert.html('下发周期任务成功');
                        temCover.show();
                        temPop.show();
					}else{
                        temTitle.find('.fa').removeClass('fa-chevron-circle-down');
                        temTitle.find('.fa').addClass('fa-warning');
                        temTitle.find('span').html('下发任务失败');
                        temAlert.html(data.message);
                        temCover.show();
                        temPop.show();
					}
                }
            });
		}
    }
    //创建按钮并给按钮添加事件
    function AddFunctionAlty(value, row, index) {
        return ['<button id="deleteBtn" type="button" class="btn btn-danger">删除</button>&nbsp;&nbsp',
            '<button id="detailBtn" type="button" class="btn  btn-warning">查看详情</button>','<i class="iconfont icon-youxiang" id="emailBtn" style="margin-left:20px;cursor: pointer"></i>'
        ].join("");
    }

    window.operateEvents = {
        "click #deleteBtn": function(e, value, row, index) {
			//调用删除任务接口
			$(".deletecover").show();
			$(".delete-alert").show();
			$(".deleteTask").click(function(){
                $(".deletecover").hide();
                $(".delete-alert").hide();
                taskDelete(row.virtualGroupId);
			});
			$(".cancel-delete").click(function(){
                $(".deletecover").hide();
                $(".delete-alert").hide();
			})

        },

		"click #detailBtn": function(e, value, row, index) {
			// var taskId=row.virtualGroupId;
			window.location.href = "taskdetail?id="+row.virtualGroupId+"&isPeriod="+row.isPeriod;
			// setCookie(taskId,taskId);
		},
		"click #emailBtn": function(e, value, row, index) {
			$("#modalSendEmail").show();
			var email=getCookie('email');
			$("#emitEmail").val(email);
			$(".progress-bg").show();
		}
    }



	//调用结果
	function result(){
        $.ajax({
            type:"get",
            url:"/service/resultEvents?virtualGroupId="+"5c372e0f43b909018fbfad51"+"&url="+"http://testphp.vulnweb.com",
            xhrFields: {withCredentials: true},
            // data:{"virtualGroupId":"5c372e0f43b909018fbfad51","url":"http://testphp.vulnweb.com"},
            dataType: "json",
            async:true,
            success:function(data){
                console.log(data);
            }
        });
	}
	//调用删除接口
	function taskDelete(id){
            $.ajax({
                type:"get",
                url:"/perform/deleteTask",
                xhrFields: {withCredentials: true},
                data:{"virtualGroupId":id},
                dataType: "json",
                async:true,
                success:function(data){
                    var type=$(".task-type-progress select").val();
                    var time=$("#datepicker").val();
                    // table.bootstrapTable('destroy');
                    tableInit(type,time);
                }
            });
	}
</script>
</body>
</html>


